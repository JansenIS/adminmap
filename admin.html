<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админка провинций</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-top: 10px; }
        input, textarea, select { width: 100%; padding: 5px; }
        button { margin-top: 15px; padding: 8px 15px; }
    </style>
</head>
<body>
    <h1>Редактирование провинций</h1>
    <select id="province-select"></select>
    <div id="form">
        <label>Название: <input id="name" /></label>
        <label>Владелец: <input id="owner" /></label>
        <label>Цвет: <input id="color" /></label>
        <label>Население: <input id="population" type="number" /></label>
        <label>Ресурсы: <textarea id="resources"></textarea></label>
        <label>Описание: <textarea id="description"></textarea></label>
        <button id="save">Сохранить</button>
    </div>

    <script>
    let provinces = [];
    async function loadProvinces() {
        const res = await fetch('/api/provinces');
        provinces = await res.json();
        const select = document.getElementById('province-select');
        provinces.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.id;
            opt.textContent = `${p.id} - ${p.name}`;
            select.appendChild(opt);
        });
        select.addEventListener('change', () => {
            const p = provinces.find(pr => pr.id == select.value);
            document.getElementById('name').value = p.name || '';
            document.getElementById('owner').value = p.owner || '';
            document.getElementById('color').value = p.color || '';
            document.getElementById('population').value = p.population || 0;
            document.getElementById('resources').value = p.resources || '';
            document.getElementById('description').value = p.description || '';
        });
        select.dispatchEvent(new Event('change'));
    }

    document.getElementById('save').addEventListener('click', async () => {
        const id = document.getElementById('province-select').value;
        const body = {
            name: document.getElementById('name').value,
            owner: document.getElementById('owner').value,
            color: document.getElementById('color').value,
            population: parseInt(document.getElementById('population').value) || 0,
            resources: document.getElementById('resources').value,
            description: document.getElementById('description').value
        };
        await fetch('/api/provinces/' + id, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        alert('Сохранено');
        const idx = provinces.findIndex(p => p.id == id);
        provinces[idx] = { ...provinces[idx], ...body };
    });

    loadProvinces();
    </script>
</body>
</html>
